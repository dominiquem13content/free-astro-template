---
import type { FAQAccordionData } from '../../../lib/cms-types';

interface Props {
  title?: string | null;
  faqs: FAQAccordionData['faqs'];
}

const { title, faqs = [] } = Astro.props;

const faqSchema = faqs.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(faq => ({
    "@type": "Question",
    "name": faq.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": faq.answer
    }
  }))
} : null;
---

{faqs.length > 0 && (
  <section class="cms-faq-section my-12">
    {title && <h2 class="text-3xl font-bold mb-6">{title}</h2>}

    <div class="space-y-4">
      {faqs.map((faq, index) => (
        <div class="faq-item border border-gray-200 rounded-lg overflow-hidden">
          <button
            type="button"
            class="faq-question w-full p-5 text-left font-semibold flex justify-between items-center hover:bg-gray-50 transition-colors"
            data-faq-toggle={`faq-${index}`}
            aria-expanded="false"
          >
            <span class="pr-4">{faq.question}</span>
            <svg
              class="faq-icon w-5 h-5 transform transition-transform flex-shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="faq-answer hidden px-5 pb-5" id={`faq-${index}`}>
            <p class="text-gray-700 leading-relaxed">{faq.answer}</p>
          </div>
        </div>
      ))}
    </div>

    {faqSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
    )}
  </section>
)}

<script>
  document.querySelectorAll('[data-faq-toggle]').forEach(button => {
    button.addEventListener('click', () => {
      const targetId = (button as HTMLElement).dataset.faqToggle;
      if (!targetId) return;

      const target = document.getElementById(targetId);
      const icon = button.querySelector('.faq-icon');

      if (target && icon) {
        target.classList.toggle('hidden');
        icon.classList.toggle('rotate-180');
        button.setAttribute('aria-expanded', target.classList.contains('hidden') ? 'false' : 'true');
      }
    });
  });
</script>
